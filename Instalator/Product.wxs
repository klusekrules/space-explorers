<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <?include definicje.wxi ?>
  <Product Name='Space-Explorers 0.0.4' Id='C5D410BC-EB65-48AD-966D-24830261DF12' UpgradeCode='90B73C3B-7192-4C3F-A82B-CB7A2C07F571'
    Language='1045' Codepage='1250' Version='0.0.4' Manufacturer='Daniel Wojdak'>

    <Package Id='*' Keywords='Installer' Description="Space-Explorers 0.0.4 Instalator"
      Comments='Komentarz' Manufacturer='Daniel Wojdak' InstallScope='perMachine'
      InstallerVersion='200' Languages='1045' Compressed='yes' SummaryCodepage='1250' Platform='$(var.Platforma)'/>

    <Media Id='1' Cabinet='Sample.cab' EmbedCab='yes' DiskPrompt='CD-ROM #1'/>
    <Property Id='DiskPrompt' Value="Space-Explorers 0.0.4 Installation [1]" />

    <Directory Id='TARGETDIR' Name='SourceDir'>

      <Directory Id='$(var.ProgramFiles)' Name="PFiles">
        <Directory Id='DANIEL_WOJDAK' Name='Daniel Wojdak'>
          <Directory Id='SPACE_EXPLORERS' Name='Space-Explorers'>
            <Directory Id='INSTALL_DIR' Name='bin'>
              <Directory Id='PLUGINS_DIR' Name='plugins'>
                <Directory Id='ZMIANA_DIR' Name='$(var.FolderZmian)'/>
              </Directory>
            </Directory>
          </Directory>
        </Directory>
      </Directory>

      <Directory Id="ProgramMenuFolder" Name="Programs">
        <Directory Id="ProgramMenuDir" Name="Space-Explorers"/>
      </Directory>

      <Directory Id="DesktopFolder" Name="Desktop" />

    </Directory>

    <DirectoryRef Id='INSTALL_DIR'>
      <Component Id='SPACE_EXPLORERS_COM' Guid='5BE847C4-843E-4D82-93EF-16190F994885' Win64='$(var.isPlatformx64)'>
        <File Id='SPACE_EXPLORERS_EXE' Name='space.exe'  Source='..\out\SpaceExplorers-$(var.Platforma)-$(var.Konfiguracja).exe' KeyPath='yes' Vital='yes' Checksum='yes' ProcessorArchitecture='$(var.Platforma)'>
          <Shortcut Id="MENU_SHORTCUT_SPACE_EXPLORERS_EXE" Directory="ProgramMenuDir" Name="Space-Explorers"
              WorkingDirectory='INSTALL_DIR' Advertise="yes" Arguments="-O $(var.PlikOpcji)"/>
          <Shortcut Id="DESKTOP_SHORTCUT_SPACE_EXPLORERS_EXE" Directory="DesktopFolder" Name="Space-Explorers"
            WorkingDirectory='INSTALL_DIR' Advertise="yes" Arguments="-O $(var.PlikOpcji)" />
        </File>
      </Component>
      <Component Id='CONFIG_XML' Guid='71AFE2C6-5700-4DC5-BB15-2539017DF28B'>
        <File Id='CONFIG_XML_FILE' Source='..\out\options_test.xml' KeyPath='yes' Vital='yes' Checksum='yes'/>
      </Component>
     <Component Id='DATA_XML' Guid='7C5B3D1A-409B-4158-9F33-46606E344BF2'>
        <File Id='DATA_XML_FILE' Source='..\out\test.xml' KeyPath='yes' Vital='yes'/>
      </Component>
      <Component Id='PLUGIN_DLL' Guid='52493997-1318-4CD2-A046-0E1E309D7FB6' Win64='$(var.isPlatformx64)'>
        <File Id='PLUGIN_DLL_FILE' Source='..\out\plug-in-$(var.Platforma)-$(var.KonfiguracjaShort).dll' KeyPath='yes' Vital='yes' Checksum='yes' ProcessorArchitecture='$(var.Platforma)'/>
      </Component>
      <Component Id='LOGGER_DLL' Guid='07CEBB01-446A-4BB8-8A5C-49CAC8354360' Win64='$(var.isPlatformx64)'>
        <File Id='LOGGER_DLL_FILE' Source='..\out\Logger-$(var.Platforma)-$(var.KonfiguracjaShort).dll' KeyPath='yes' Vital='yes' Checksum='yes' ProcessorArchitecture='$(var.Platforma)'/>
      </Component>
      <Component Id='TRANSF_DLL' Guid='C9CDD52F-E2F0-49F4-8804-97CDB1DFA530' Win64='$(var.isPlatformx64)'>
        <File Id='TRANSF_DLL_FILE' Source='..\out\ftrans-$(var.Platforma)-$(var.KonfiguracjaShort).dll' KeyPath='yes' Vital='yes' Checksum='yes' ProcessorArchitecture='$(var.Platforma)'/>
      </Component>
    </DirectoryRef>
    
    <DirectoryRef Id='ZMIANA_DIR'>
      <Component Id='ZMIANA_TEST_DLL' Guid='5BB3843E-C319-4D3E-8896-92C9B1BDCED6' Win64='$(var.isPlatformx64)'>
        <File Id='ZMIANA_TEST_DLL_FILE' Source='..\out\plugins\$(var.FolderZmian)\test-zmiana-$(var.Platforma)-$(var.KonfiguracjaShort).dll' ProcessorArchitecture='$(var.Platforma)' KeyPath='yes' Vital='yes' Checksum='yes'/>
      </Component>
    </DirectoryRef>
      
    <DirectoryRef Id="ProgramMenuDir">
      <Component Id="ProgramMenuDir" Guid="ABB83391-1450-4BB1-B391-1353AA8111D4">
        <RemoveFolder Id='ProgramMenuDir' On='uninstall' />
        <RegistryValue Root='HKCU' Key='Software\[Manufacturer]\[ProductName]' Type='string' Value='' KeyPath='yes' />
      </Component>
    </DirectoryRef>
    
     <DirectoryRef Id="SPACE_EXPLORERS">
      <Component Id="SPACE_EXPLORERS_REM" Guid="D2920ACC-823F-430C-90EC-E07FC8EB400E">
        <RemoveFolder Id='SPACE_EXPLORERS_REM_FOL' On='uninstall' />
        <RegistryValue Root='HKCU' Key='Software\[Manufacturer]\[ProductName]' Type='string' Value='' KeyPath='yes' />
      </Component>
    </DirectoryRef>
    
    <Feature Id='Complete' Title='Space-Explorers 0.0.4' Description='Moja aplikacja'
      Display='expand' Level='1' AllowAdvertise='no' ConfigurableDirectory="SPACE_EXPLORERS" >
      <ComponentRef Id='SPACE_EXPLORERS_COM' />
      <ComponentRef Id='CONFIG_XML' />
      <ComponentRef Id='DATA_XML' />
      <ComponentRef Id='PLUGIN_DLL' />
      <ComponentRef Id='LOGGER_DLL' />
      <ComponentRef Id='TRANSF_DLL' />
      <ComponentRef Id='ZMIANA_TEST_DLL' />
      <ComponentRef Id='ProgramMenuDir' />
      <ComponentRef Id='SPACE_EXPLORERS_REM' />
    </Feature>
    <UI Id="MyWixUI_InstallDir">
      <UIRef Id="WixUI_InstallDir" />
      <UIRef Id="WixUI_ErrorProgressText" />
      
      <DialogRef Id="UserRegistrationDlg" />

      <Publish Dialog="LicenseAgreementDlg" Control="Next" Event="NewDialog" Value="UserRegistrationDlg" Order="3">LicenseAccepted = "1"</Publish>
      <Publish Dialog="InstallDirDlg" Control="Back" Event="NewDialog" Value="UserRegistrationDlg">1</Publish>
    </UI>
    <Property Id="PIDTemplate"><![CDATA[12345<##### ##### ##### ##### #####>@@@@@]]></Property>
    <Property Id="WIXUI_INSTALLDIR" Value="SPACE_EXPLORERS" />
    <WixVariable Id="WixUILicenseRtf" Value="..\gpl-3.0.rtf" />
  </Product>
  <Fragment>
    <UI>
      <Dialog Id="UserRegistrationDlg" Width="370" Height="270" Title="!(loc.UserRegistrationDlg_Title)" NoMinimize="yes">
        <Control Id="NameLabel" Type="Text" X="45" Y="73" Width="100" Height="15" TabSkip="no" Text="!(loc.UserRegistrationDlg_UserName)" />
        <Control Id="NameEdit" Type="Edit" X="45" Y="85" Width="220" Height="18" Property="USERNAME" Text="{80}" />
        <Control Id="OrganizationLabel" Type="Text" X="45" Y="110" Width="100" Height="15" TabSkip="no" Text="!(loc.UserRegistrationDlg_Organization)" />
        <Control Id="OrganizationEdit" Type="Edit" X="45" Y="122" Width="220" Height="18" Property="COMPANYNAME" Text="{80}" />
        <Control Id="CDKeyLabel" Type="Text" X="45" Y="147" Width="50" Height="10" TabSkip="no">
          <Text>CD Key:</Text>
        </Control>
        <Control Id="CDKeyEdit" Type="MaskedEdit" X="45" Y="159" Width="250" Height="16" Property="PIDKEY" Text="[PIDTemplate]" />
        <Control Id="Back" Type="PushButton" X="180" Y="243" Width="56" Height="17" Text="!(loc.WixUIBack)">
          <Publish Event="NewDialog" Value="LicenseAgreementDlg">1</Publish>
        </Control>
        <Control Id="Next" Type="PushButton" X="236" Y="243" Width="56" Height="17" Default="yes" Text="!(loc.WixUINext)">
          <Publish Event="ValidateProductID" Value="0">1</Publish>
          <Publish Event="SpawnWaitDialog" Value="WaitForCostingDlg">CostingComplete = 1</Publish>
          <Publish Event="NewDialog" Value="InstallDirDlg">ProductID</Publish>
        </Control>
        <Control Id="Cancel" Type="PushButton" X="304" Y="243" Width="56" Height="17" Cancel="yes" Text="!(loc.WixUICancel)">
          <Publish Event="SpawnDialog" Value="CancelDlg">1</Publish>
        </Control>
        <Control Id="BannerBitmap" Type="Bitmap" X="0" Y="0" Width="370" Height="44" TabSkip="no" Text="WixUI_Bmp_Banner" />
        <Control Id="Description" Type="Text" X="25" Y="23" Width="280" Height="15" Transparent="yes" NoPrefix="yes">
          <Text>Please enter your customer information</Text>
        </Control>
        <Control Id="BottomLine" Type="Line" X="0" Y="234" Width="370" Height="0" />
        <Control Id="Title" Type="Text" X="15" Y="6" Width="200" Height="15" Transparent="yes" NoPrefix="yes">
          <Text>{\WixUI_Font_Title}Customer Information</Text>
        </Control>
        <Control Id="BannerLine" Type="Line" X="0" Y="44" Width="370" Height="0" />
      </Dialog>
    </UI>
  </Fragment>
</Wix>